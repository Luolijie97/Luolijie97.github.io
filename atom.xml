<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://luolijie97.github.io/</id>
    <title>lljçš„blog</title>
    <updated>2020-03-18T10:12:09.042Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://luolijie97.github.io/"/>
    <link rel="self" href="https://luolijie97.github.io/atom.xml"/>
    <subtitle>llj&apos;s blog</subtitle>
    <logo>https://luolijie97.github.io/images/avatar.png</logo>
    <icon>https://luolijie97.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, lljçš„blog</rights>
    <entry>
        <title type="html"><![CDATA[AudioQueueå­¦ä¹ ï¼ˆäºŒï¼‰: éŸ³é¢‘é˜Ÿåˆ—å½•éŸ³çš„ä½¿ç”¨]]></title>
        <id>https://luolijie97.github.io/post/audioqueue-yin-pin-dui-lie-lu-yin-shi-yong</id>
        <link href="https://luolijie97.github.io/post/audioqueue-yin-pin-dui-lie-lu-yin-shi-yong">
        </link>
        <updated>2020-03-18T10:00:25.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>
<p>ä¸Šç¯‡ä»‹ç»äº†AudioQueueå½•éŸ³çš„ç›¸å…³åŸç†ï¼Œè¿™ç¯‡ä¸ºæœ‰å…³å®ç°ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-swift">//  AudioQueueRecorder.swift
import Foundation
import AudioToolbox
import AVFoundation

/// å½•éŸ³é˜Ÿåˆ—å›è°ƒå‡½æ•°
/// - Parameters:
///   - inUserData: ä¸€ä¸ªè‡ªå®šä¹‰ç»“æ„ï¼ŒåŒ…å«éŸ³é¢‘é˜Ÿåˆ—çš„çŠ¶æ€æ•°æ®
///   - inAQ: è°ƒç”¨å›è°ƒå‡½æ•°çš„éŸ³é¢‘é˜Ÿåˆ—
///   - inBuffer: åŒ…å«éŸ³é¢‘æ•°æ®çš„éŸ³é¢‘é˜Ÿåˆ—ç¼“å†²åŒº
///   - inStartTime: å½“å‰éŸ³é¢‘æ•°æ®çš„æ—¶é—´æˆ³ï¼Œç”¨äºåŒæ­¥
///   - inNumberPacketDescription: inPacketDescså‚æ•°ä¸­çš„æ•°æ®åŒ…æè¿°çš„æ•°é‡ã€‚å½•åˆ¶VBRï¼ˆåŠ¨æ€æ¯”ç‰¹ç‡ï¼‰æ ¼å¼æ—¶éŸ³é¢‘é˜Ÿåˆ—ä¼šæä¾›è¯¥å‚æ•°å€¼ï¼ŒCBRï¼ˆå›ºå®šæ¯”ç‰¹ç‡ï¼‰æ ¼å¼æ—¶å€¼ä¸º0
///   - inPacketDescs: éŸ³é¢‘æ•°æ®ä¸­ä¸€ç»„åŒ…çš„æè¿°ï¼Œå½•åˆ¶VBRæ ¼å¼æ•°æ®æ—¶éœ€è¦å°†å€¼ä¼ é€’ç»™AudioFileWritePacketså‡½æ•°
func AQAudioQueueInputCallback(inUserData: UnsafeMutableRawPointer?,
                               inAQ: AudioQueueRef,
                               inBuffer: AudioQueueBufferRef,
                               inStartTime: UnsafePointer&lt;AudioTimeStamp&gt;,
                               inNumberPacketDescription: UInt32,
                               inPacketDescs: UnsafePointer&lt;AudioStreamPacketDescription&gt;?) {
    //è½¬æ¢ä¸ºæŒ‡å®šç±»å‹
    let audioService = unsafeBitCast(inUserData!, to:AudioService.self)
    audioService.writePackets(inBuffer: inBuffer)
    AudioQueueEnqueueBuffer(inAQ, inBuffer, 0, nil);
    
    print(&quot;startingPacketCount: \(audioService.startingPacketCount), maxPacketCount: \(audioService.maxPacketCount)&quot;)
    if (audioService.maxPacketCount &lt;= audioService.startingPacketCount) {
//        audioService.stopRecord()
        NotificationCenter.default.post(name: .init(rawValue: &quot;stopRecord&quot;), object: nil, userInfo: nil)
    }
}

class AudioService {
    /// é˜Ÿåˆ—çš„bufferä¸ªæ•°
    let kNumberBuffers: Int = 3
    var buffer: UnsafeMutableRawPointer
    var audioQueueObject: AudioQueueRef?
    /// è®°å½•éŸ³é¢‘æ•°æ®çš„æ–‡ä»¶çš„éŸ³é¢‘æ–‡ä»¶å¯¹è±¡
    public var mAudioFile: AudioFileID?
    /// åˆå§‹packetæ•°é‡
    var startingPacketCount: UInt32
    let bytesPerPacket: UInt32 = 2
    /// æ¯ä¸ªéŸ³é¢‘é˜Ÿåˆ—ç¼“å†²åŒºçš„å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)
    var bufferByteSize: UInt32 = 0
    /// å½•éŸ³æœ€å¤§æ—¶é•¿
    let maxSeconds: UInt32 = 10
    /// æ¯æ¬¡å›è°ƒæ—¶é•¿,å•ä½ç§’
    let second: UInt32 = 3
    /// æ¯æ¬¡å›è°ƒæ‰€éœ€å†™å…¥çš„packetçš„æ•°é‡ = é‡‡æ ·é¢‘ç‡ * æ¯æ¬¡å›è°ƒæ—¶é•¿
    let numPacketsToWrite: UInt32
    /// å½“å‰å½•éŸ³çš„æœ€å¤§å†™å…¥packetæ•°é‡ = é‡‡æ ·é¢‘ç‡ * å½•éŸ³æœ€å¤§æ—¶é•¿
    var maxPacketCount: UInt32
    /// å½•éŸ³é‡‡æ ·é¢‘ç‡
    let sampleRate = 44100.0
    /// éŸ³é¢‘æ ¼å¼
    var audioFormat: AudioStreamBasicDescription {
        return AudioStreamBasicDescription(mSampleRate: sampleRate,
                                           mFormatID: kAudioFormatLinearPCM,
                                           mFormatFlags: AudioFormatFlags(kLinearPCMFormatFlagIsSignedInteger | kLinearPCMFormatFlagIsPacked),
                                           mBytesPerPacket: 2,
                                           mFramesPerPacket: 1,
                                           mBytesPerFrame: 2,
                                           mChannelsPerFrame: 1,
                                           mBitsPerChannel: 16,
                                           mReserved: 0)
    }
    /// å½•éŸ³å¼€å§‹æ ‡å¿—
    var isRecording:Bool = false

    init() {
        startingPacketCount = 0
        numPacketsToWrite = UInt32(sampleRate) * second
        maxPacketCount = (UInt32(sampleRate) * maxSeconds)
        buffer = UnsafeMutableRawPointer(malloc(Int(maxPacketCount * bytesPerPacket)))
        
        print(&quot;startRecord&quot;)
        guard audioQueueObject == nil else  { return }
        prepareForRecord()
    }

    deinit {
        buffer.deallocate()
    }

    func startRecord() {
//        print(&quot;startRecord&quot;)
//        guard audioQueueObject == nil else  { return }
//        prepareForRecord()
        let err: OSStatus = AudioQueueStart(audioQueueObject!, nil)
        print(&quot;err: \(err)&quot;)
    }

    func stopRecord() {
        AudioQueueStop(audioQueueObject!, true)
        AudioQueueDispose(audioQueueObject!, true)
        audioQueueObject = nil
    }
    

    private func prepareForRecord() {
        print(&quot;prepareForRecord&quot;)
        var audioFormat = self.audioFormat
    
        //åˆ›å»ºä¸€ä¸ªå½•éŸ³é˜Ÿåˆ—
        if AudioQueueNewInput(&amp;audioFormat,
                              AQAudioQueueInputCallback,
                              unsafeBitCast(self, to: UnsafeMutableRawPointer.self),
                              CFRunLoopGetCurrent(),
                              CFRunLoopMode.commonModes.rawValue,
                              0,
                              &amp;audioQueueObject) == noErr {
            print(&quot;å½•éŸ³é˜Ÿåˆ—åˆ›å»ºæˆåŠŸ!&quot;)
        } else {
            print(&quot;å½•éŸ³é˜Ÿåˆ—åˆ›å»ºå¤±è´¥!!&quot;)
            return
        }
        
        // è·å–è®¾ç½®çš„éŸ³é¢‘æµæ ¼å¼
        var dataFormatSize: UInt32 = UInt32(MemoryLayout&lt;AudioStreamBasicDescription&gt;.size)
        //ç”¨ä»¥ä¸‹æ–¹æ³•éªŒè¯è·å–åˆ°éŸ³é¢‘æ ¼å¼æ˜¯å¦ä¸æˆ‘ä»¬è®¾ç½®çš„ç›¸ç¬¦
        if AudioQueueGetProperty(audioQueueObject!, kAudioQueueProperty_StreamDescription, &amp;audioFormat, &amp;dataFormatSize) == noErr {
            print(&quot;éŸ³é¢‘æµæ ¼å¼è®¾ç½®æˆåŠŸ!&quot;)
        } else {
            print(&quot;éŸ³é¢‘æµæ ¼å¼è®¾ç½®å¤±è´¥!!&quot;)
            return
        }
        
        // åˆ›å»ºéŸ³é¢‘æ–‡ä»¶è·¯å¾„
        let fileManager = FileManager()
        let filePath = NSSearchPathForDirectoriesInDomains(.documentDirectory, .userDomainMask, true).first?.appending(&quot;/record.caf&quot;)
        if !fileManager.fileExists(atPath: filePath!) {
            fileManager.createFile(atPath: filePath!, contents: nil, attributes: nil)
        }
        let outputURL = URL(fileURLWithPath: filePath!)
        // åˆ›å»ºéŸ³é¢‘æ–‡ä»¶
        if AudioFileCreateWithURL(outputURL as CFURL, kAudioFileCAFType, &amp;audioFormat, .eraseFile, &amp;mAudioFile) == noErr {
            print(&quot;åˆ›å»ºéŸ³é¢‘æ–‡ä»¶æˆåŠŸï¼&quot;)
            print(&quot;éŸ³é¢‘æ–‡ä»¶URL: &quot;, outputURL)
        } else {
            print(&quot;åˆ›å»ºéŸ³é¢‘æ–‡ä»¶å¤±è´¥!ï¼&quot;)
            return
        }
        
        
        startingPacketCount = 0;
        var buffers = Array&lt;AudioQueueBufferRef?&gt;(repeating: nil, count: kNumberBuffers)
        /// è®¡ç®—Audio Queueä¸­æ¯ä¸ªbufferçš„å¤§å°
        bufferByteSize = numPacketsToWrite * audioFormat.mBytesPerPacket
        // å†…å­˜åˆ†é…,å…¥é˜Ÿ
        for bufferIndex in 0 ..&lt; buffers.count {
            AudioQueueAllocateBuffer(audioQueueObject!, bufferByteSize, &amp;buffers[bufferIndex])
            AudioQueueEnqueueBuffer(audioQueueObject!, buffers[bufferIndex]!, 0, nil)
        }
        
        
    }
    
    func writePackets(inBuffer: AudioQueueBufferRef) {
        print(&quot;writePackets&quot;)
        //ç¼“å†²åŒºä¸­æ•°æ®çš„æ€»å­—èŠ‚æ•°é™¤ä»¥æ¯ä¸ªæ•°æ®åŒ…çš„(å¸¸æ•°)å­—èŠ‚æ•°
        var numPackets: UInt32 = (inBuffer.pointee.mAudioDataByteSize / bytesPerPacket)
        if ((maxPacketCount - startingPacketCount) &lt; numPackets) {
            numPackets = (maxPacketCount - startingPacketCount)
        }
        print(&quot;writePackets mAudioDataByteSize: \(inBuffer.pointee.mAudioDataByteSize), numPackets: \(numPackets)&quot;)
        
        if 0 &lt; numPackets {
            //å°†å½“å‰bufferæ·»åˆ°æ€»çš„bufferä¸­
            memcpy(buffer.advanced(by: Int(bytesPerPacket * startingPacketCount)),
                   inBuffer.pointee.mAudioData,
                   Int(bytesPerPacket * numPackets))
           
            
            //å°†ç¼“å†²åŒºçš„å†…å®¹å†™å…¥éŸ³é¢‘æ•°æ®æ–‡ä»¶
            if AudioFileWritePackets(mAudioFile!,
                                     false,
                                     bufferByteSize,
                                     nil,
                                     Int64(startingPacketCount),
                                     &amp;numPackets,
                                     inBuffer.pointee.mAudioData) == noErr {
                print(&quot;å½“å‰ç¼“å†²åŒºå·²å†™å…¥ï¼&quot;)
            } else {
                print(&quot;å†™å…¥å¤±è´¥ï¼ï¼&quot;)
            }
             startingPacketCount += numPackets
        }
        
    }
}

</code></pre>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[AudioQueueå­¦ä¹ ï¼ˆä¸€ï¼‰: åˆ†ç‰‡å½•éŸ³åŸç†]]></title>
        <id>https://luolijie97.github.io/post/audioqueue-fen-pian-lu-yin-yuan-li</id>
        <link href="https://luolijie97.github.io/post/audioqueue-fen-pian-lu-yin-yuan-li">
        </link>
        <updated>2020-03-18T09:31:31.000Z</updated>
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬åŸç†ä»‹ç»">åŸºæœ¬åŸç†ä»‹ç»</h2>
<ul>
<li>è¦åœ¨ <code>iOS</code> è®¾å¤‡ä¸Šå½•åˆ¶éŸ³é¢‘ï¼Œè‹¹æœæ¨èæˆ‘ä»¬ä½¿ç”¨ <code>AVFoundation</code> æ¡†æ¶ä¸­çš„ <code>AVAudioRecorder</code> ç±»ã€‚è™½ç„¶ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¸æ”¯æŒæµå¼ï¼›è¿™å°±æ„å‘³ç€åœ¨å½•éŸ³æ—¶ï¼Œå¿…é¡»ç­‰åˆ°å½•éŸ³ç»“æŸåï¼Œæ‰èƒ½è·å–åˆ°å½•éŸ³æ•°æ®ã€‚è¿™ç»™åº”ç”¨é€ æˆäº†å¾ˆå¤§çš„å±€é™æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ <code>Audio Queue Services</code> æ¥å½•åˆ¶éŸ³é¢‘ã€‚</li>
</ul>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<img src="https://developer.apple.com/library/archive/documentation/MusicAudio/Conceptual/AudioQueueProgrammingGuide/Art/recording_callback_function_2x.png" alt="Illustration of the recording process when using an audio queue" style="zoom:33%;" />
<ul>
<li>éŸ³é¢‘çš„è¾“å…¥åˆ†ä¸ºä¸Šå›¾æ‰€ç¤ºå‡ ä¸ªæ­¥éª¤ï¼š
<ul>
<li>æ­¥éª¤1ï¼Œå¼€å§‹å½•éŸ³ã€‚å°†éŸ³é¢‘å¡«å…¥ç¬¬ä¸€ä¸ªç¼“å†²åŒºä¸­</li>
<li>æ­¥éª¤2ä¸­ï¼Œç¬¬ä¸€ä¸ªç¼“å†²åŒºå·²è¢«å¡«æ»¡ï¼Œæ­¤æ—¶éŸ³é¢‘é˜Ÿåˆ—å°†è¿›è¡Œå›è°ƒï¼Œå¹¶å°†å¡«æ»¡çš„ç¼“å†²åŒºï¼ˆç¼“å†²åŒº1ï¼‰ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚åŒæ—¶ï¼ŒéŸ³é¢‘é˜Ÿåˆ—å°†æ–°è·å¾—çš„æ•°æ®å¡«å……å¦ä¸€ä¸ªç¼“å†²åŒºï¼ˆç¼“å†²åŒº2ï¼‰</li>
<li>åœ¨å›è°ƒå‡½æ•°ä¸­éœ€è¦å°†éŸ³é¢‘æ•°æ®æµè¿›è¡Œç›¸å…³æ“ä½œï¼ˆå†™å…¥ç£ç›˜ï¼‰</li>
<li>åœ¨æ­¥éª¤4ä¸­ï¼ŒéŸ³é¢‘é˜Ÿåˆ—ä¼šå°†åˆšåˆšå†™å…¥ç£ç›˜çš„ç¼“å†²åŒº(buffer 1)é‡æ–°æ”¾å…¥ç¼“å†²é˜Ÿåˆ—ï¼ŒéŸ³é¢‘é˜Ÿåˆ—å†æ¬¡è°ƒç”¨å›è°ƒ(æ­¥éª¤5) ï¼Œå¹¶å°†å¡«æ»¡çš„ç¼“å†²åŒºï¼ˆç¼“å†²åŒº2ï¼‰ä¼ é€’ç»™å›è°ƒå‡½æ•°ï¼Œå†å°†è¿™ä¸ªç¼“å†²åŒºçš„å†…å®¹å†™å…¥éŸ³é¢‘æ–‡ä»¶(æ­¥éª¤6)</li>
<li>ä¸Šè¿°å¾ªç¯å°†ä¸€ç›´æŒç»­åˆ°ç”¨æˆ·åœæ­¢å½•éŸ³ä¸ºæ­¢</li>
</ul>
</li>
</ul>
<h2 id="å…·ä½“æ“ä½œ">å…·ä½“æ“ä½œ</h2>
<hr>
<h3 id="1-è®¾ç½®éŸ³é¢‘æ ¼å¼">1ã€è®¾ç½®éŸ³é¢‘æ ¼å¼</h3>
<ul>
<li>è®¾ç½®éŸ³é¢‘çš„é‡‡æ ·ç‡mSampleRateã€PCMæµæ ¼å¼mFormatIDã€æ ‡ç­¾æ ¼å¼mFormatFlagsã€å£°é“æ•°mChannelsPerFrameã€æ¯ä¸ªæ•°æ®åŒ…çš„å­—èŠ‚æ•°mBytesPerPacketã€æ¯ä¸ªæ•°æ®åŒ…çš„å¸§æ•°mFramesPerPacketã€æ¯å¸§çš„å­—èŠ‚æ•°mBytesPerFrameã€è¯­è¨€çš„é‡‡æ ·ç‚¹æ•°mBitsPerChannelã€ä¿ç•™ä½mReserved</li>
</ul>
<h3 id="2-åˆå§‹åŒ–å¹¶ä¸ºaudio-queueåˆ†é…å†…å­˜">2ã€åˆå§‹åŒ–å¹¶ä¸ºAudio Queueåˆ†é…å†…å­˜</h3>
<ul>
<li>åˆ›å»ºéŸ³é¢‘è¾“å…¥é˜Ÿåˆ—AudioQueueNewInputï¼ŒæŒ‡å®šå›è°ƒå‡½æ•°AQAudioQueueInputCallback</li>
<li>åˆ›å»ºç¼“å†²å™¨ï¼šåˆ†é…å†…å­˜AudioQueueAllocateBufferï¼Œå…¥é˜ŸAudioQueueEnqueueBuffer</li>
<li>åˆ›å»ºå†…å­˜ç©ºé—´bufferï¼šç”¨äºå­˜æ”¾å®Œæ•´å½•éŸ³çš„æ•°æ®</li>
</ul>
<h3 id="3-å¯åŠ¨audio-queueå¼€å§‹å½•éŸ³">3ã€å¯åŠ¨Audio Queueï¼Œå¼€å§‹å½•éŸ³</h3>
<ul>
<li>AudioQueueStartå¯åŠ¨å½•åˆ¶</li>
</ul>
<h3 id="4-å›è°ƒå‡½æ•°ä¸­æ¥æ”¶éŸ³é¢‘æ•°æ®">4ã€å›è°ƒå‡½æ•°ä¸­æ¥æ”¶éŸ³é¢‘æ•°æ®</h3>
<pre><code class="language-swift">func AQAudioQueueInputCallback(inUserData: UnsafeMutableRawPointer?,
                               inAQ: AudioQueueRef,
                               inBuffer: AudioQueueBufferRef,
                               inStartTime: UnsafePointer&lt;AudioTimeStamp&gt;,
                               inNumberPacketDescriptions: UInt32,
                               inPacketDescs: UnsafePointer&lt;AudioStreamPacketDescription&gt;?) {}
</code></pre>
<ul>
<li>åœ¨å›è°ƒå‡½æ•°AQAudioQueueInputCallbackä¸­ï¼ŒinBufferå³ä¸ºæ¯æ¬¡å¡«æ»¡ Audio Queueäº§ç”Ÿçš„éŸ³é¢‘æ•°æ®ï¼Œæ¯æ¬¡éƒ½å°†å½“å‰åˆ†ç‰‡æ•°æ®åŠ å…¥bufferä¸­</li>
<li>æˆ‘ä»¬å°†æ‹¿åˆ°çš„inbufferè½¬æ¢æˆswiftä¸­çš„NSDataæ•°æ®ï¼Œå¹¶æ‹¼æ¥ä¸Š44å­—èŠ‚çš„WAVæ ¼å¼çš„å¤´éƒ¨ï¼Œå³å¯å¾—åˆ°å½“å‰åˆ†ç‰‡çš„wavéŸ³é¢‘ã€‚</li>
</ul>
<h3 id="5-ä½¿ç”¨alamofiireå°†éŸ³é¢‘ä¼ ç»™æœåŠ¡å™¨">5ã€ä½¿ç”¨Alamofiireå°†éŸ³é¢‘ä¼ ç»™æœåŠ¡å™¨</h3>
<ul>
<li>å®é™…é¡¹ç›®ä¸­å¯æ ¹æ®éœ€è¦ï¼Œç»“åˆAlamofireå®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹å‰çš„éŸ³é¢‘åˆ†ç‰‡ä¼ è¾“ã€‚åœ¨å›è°ƒå‡½æ•°<strong>AQAudioQueueInputCallback</strong>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°å›è°ƒçš„éŸ³é¢‘æµ<strong>inBuffer</strong>ã€‚</li>
</ul>
<h3 id="6-åœæ­¢å½•éŸ³">6ã€åœæ­¢å½•éŸ³</h3>
<ul>
<li>åœæ­¢å½•éŸ³é˜Ÿåˆ—AudioQueueStop</li>
<li>ç§»é™¤ç¼“å†²åŒºAudioQueueDispose</li>
<li>å°†å®Œæ•´çš„éŸ³é¢‘bufferæ•°æ®è½¬æˆNSDataæ•°æ®ï¼Œç”¨äºå¤„ç†å½“éŸ³é¢‘ä¼ è¾“ç»™æœåŠ¡å™¨æ—¶errorCode=1çš„æƒ…å†µ</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Accelerateæ¡†æ¶ä¹‹vDSPåº“çš„åŸºç¡€ä½¿ç”¨]]></title>
        <id>https://luolijie97.github.io/post/accelerate-kuang-jia-zhi-vdsp-ku-de-ji-chu-shi-yong</id>
        <link href="https://luolijie97.github.io/post/accelerate-kuang-jia-zhi-vdsp-ku-de-ji-chu-shi-yong">
        </link>
        <updated>2020-01-27T04:59:28.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘éœ€è¦å°†ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„éŸ³é«˜æå–ç®—æ³•è½¬æˆswift playgroundä¸­èƒ½è¿è¡Œçš„swiftç‰ˆæœ¬ï¼Œåœ¨å…¶ä¸­è¦æ”¹å†™fftå˜æ¢ç­‰Cè¯­è¨€ä¸­éœ€è¦è¿›è¡Œä¸Šä¸‡æ¬¡å¾ªç¯çš„ä»£ç ã€‚æœ€å¼€å§‹æˆ‘é‡‡ç”¨äº†æœ€ç®€å•ç²—æš´çš„æ–¹æ³•è¿›è¡Œç›´æ¥æ”¹å†™ï¼Œè™½ç„¶èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œä½†å®é™…æ€§èƒ½ä¸Šå®Œå…¨æ— æ³•è¾¾åˆ°è¦æ±‚ã€‚åœ¨æŸ¥é˜…æœ‰å…³èµ„æ–™åï¼Œå‘ç°Accelerateæ¡†æ¶æ­£æ˜¯Swiftä¸­ç”¨æ¥è¿›è¡Œå¤§é‡æ•°å­¦å’Œå›¾åƒè®¡ç®—çš„å·¥å…·ï¼Œä½†ç½‘ç»œä¸Šç›¸å…³ä¸­æ–‡æ–‡æ¡£æ€»ç»“å‡ ä¹æ²¡æœ‰æ·±å…¥ä»‹ç»ï¼Œç°æ ¹æ®æˆ‘å¯¹developer documentationå’Œstackflowä¸Šçš„ç›¸å…³æé—®ï¼Œå¯¹é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„vDSPåº“è¿›è¡Œå°ç»“</p>
</blockquote>
<h3 id="å¼•ç”¨åŸå› ">å¼•ç”¨åŸå› </h3>
<ul>
<li>æˆ‘ä»¬ä»¥å‘é‡è¿ç®—ä¸ºä¾‹å±•å¼€è¯´æ˜ï¼š</li>
</ul>
<blockquote>
<pre><code class="language-swift">    let a: [Float] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    let b: [Float] = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
    let c: Float = 2
    var d = [Float](repeating: .nan, count: a.count)

    var startTime = CFAbsoluteTimeGetCurrent()
    //(a[i]+b[i])*(a[i]-b[i])
    for i in 0..&lt;a.count {
        d[i] = (a[i] + b[i]) * (a[i] - b[i])
    }
    print(d)
    var endTime = CFAbsoluteTimeGetCurrent()
    print(&quot;caculate: \((endTime - startTime) * 1000) ms&quot;) 
		//caculate: 0.32007694244384766 ms

    startTime = CFAbsoluteTimeGetCurrent()
    //(a[i]+b[i])*(a[i]-b[i])
    d = vDSP.multiply(addition: (a, b), subtraction: (a, b))//(a[i]+b[i])*(a[i]-b[i])
    print(d)
    endTime = CFAbsoluteTimeGetCurrent()
    print(&quot;caculate: \((endTime - startTime) * 1000) ms&quot;)
		//caculate: 0.09799003601074219 ms
</code></pre>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬å–äº†é•¿åº¦ä¸º10çš„æ•°ç»„è¿›è¡Œäº†åŠ å‡ä¹˜è¿ç®—ï¼Œä»è¿è¡Œæ—¶é—´çœ‹ï¼Œåè€…åªç”¨äº†1/3çš„æ—¶é—´ã€‚å½“å‘é‡é•¿åº¦è¾ƒå¤§æ—¶ï¼Œæ¯”å¦‚å‡ åƒã€ç”šè‡³ä¸Šä¸‡æ—¶ï¼ŒvDSPåº“è¿›è¡Œæ•°ç»„è¿ç®—çš„æ•ˆç‡æå‡å°±æ›´ä¸ºæ˜æ˜¾äº†ï¼Œå°¤å…¶æ˜¯åœ¨ä»£ç ä¸­éœ€è¦å¤šå±‚å¾ªç¯è¿›è¡Œè®¡ç®—æ—¶ã€‚ç»æµ‹è¯•ï¼Œå¹³å‡æ¯å±‚å¾ªç¯é‡‡ç”¨vDSPåº“ä¸­çš„å‡½æ•°å¯æé«˜8-10çš„é€Ÿåº¦</li>
</ul>
</blockquote>
<h3 id="vdspåº“ä»‹ç»">vDSPåº“ä»‹ç»</h3>
<p>vDSPæ¡†æ¶åŒ…å«ç”¨äºæ•°å­—ä¿¡å·å¤„ç†å’Œå¤§å‹é˜µåˆ—çš„é€šç”¨ç®—æ³•çš„é«˜åº¦ä¼˜åŒ–çš„åŠŸèƒ½çš„é›†åˆ</p>
<h3 id="å‘é‡åŸºæœ¬è¿ç®—">å‘é‡åŸºæœ¬è¿ç®—</h3>
<ul>
<li>
<p>æ—§API</p>
<blockquote>
<pre><code class="language-swift">let stride = vDSP_Stride(1) //ç¡®å®šè¿ç®—å¤„ç†çš„è·¨åº¦ï¼Œ1ä»£è¡¨å¯¹æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œ
let a:[Float] = [2, 4, 3, 4, 5]
let b:[Float] = [35, 21, 62, 54, 45]
let len = vDSP_Length(a.count) //æ“ä½œå…ƒç´ çš„æ•°é‡
var c = [Float](repeating: 0, count: a.count)//å­˜æ”¾æ“ä½œç»“æœ
var d = [Float](repeating: 0, count: a.count)//å­˜æ”¾æ“ä½œç»“æœ

//äºŒå…ƒè¿ç®—
vDSP_vadd(a, stride, b, stride, &amp;c, stride, len) //åŠ æ³•è¿ç®—
print(c) // [37.0, 25.0, 65.0, 58.0, 50.0]

vDSP_vsub(a, stride, b, stride, &amp;c, stride, len) //å‡æ³•è¿ç®—b-a
print(c) // [33.0, 17.0, 59.0, 50.0, 40.0]

//ä»¥ä¸Šä¸¤å¥å¯åˆæˆä¸€å¥
vDSP_vaddsub(a, stride, b, stride, &amp;c, stride, &amp;d, stride, len)
print(&quot;add: &quot;, c) //add:  [37.0, 25.0, 65.0, 58.0, 50.0]
print(&quot;sub: &quot;, d) //sub:  [33.0, 17.0, 59.0, 50.0, 40.0]

vDSP_vmul(a, stride, b, stride, &amp;c, stride, len) //ä¹˜æ³•è¿ç®—
print(c) //[70.0, 84.0, 186.0, 216.0, 225.0]

vDSP_vdiv(a, stride, b, stride, &amp;c, stride, len) //é™¤æ³•è¿ç®—b/a
print(c) //[17.499998, 5.2499995, 20.666666, 13.499999, 8.999999]

//ä¸‰å…ƒè¿ç®—
let m:[Float] = [3, 4, 5, 6, 7]

vDSP_vam(a, stride, b, stride, m, stride, &amp;c, stride, len) //c = (a+b)*m
print(c) //[111.0, 100.0, 325.0, 348.0, 350.0]

vDSP_vma(a, stride, b, stride, m, stride, &amp;c, stride, len) //c = a*b+m
print(c) //[73.0, 88.0, 191.0, 222.0, 232.0]

vDSP_vmsb(a, stride, b, stride, m, stride, &amp;c, stride, len) //c = a*b-m
print(c) //[67.0, 80.0, 181.0, 210.0, 218.0]

vDSP_vsbm(a, stride, b, stride, m, stride, &amp;c, stride, len) //c = (a-b)*c
print(c) //[-99.0, -68.0, -295.0, -300.0, -280.0]

//å››å…ƒè¿ç®—
let n:[Float] = [7, 6, 5, 4, 3]

vDSP_vsbsbm(a, stride, b, stride, m, stride, n, stride, &amp;c, stride, len) //c = (a-b)*(m-n)
print(c) //[132.0, 34.0, -0.0, -100.0, -160.0]

vDSP_vasbm(a, stride, b, stride, m, stride, n, stride, &amp;c, stride, len) //c = (a+b)*(m-n)
print(c) //[-148.0, -50.0, 0.0, 116.0, 200.0]
</code></pre>
</blockquote>
</li>
<li>
<p>æ–°API</p>
<blockquote>
<pre><code class="language-swift"> let a: [Float] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 let b: [Float] = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
 let c: Float = 2
 var d = [Float](repeating: .nan, count: a.count)
 
 d = vDSP.add(a, b) //(a[i]+b[i])
 print(d)
 d = vDSP.add(5, a) //a[i]+5
 print(d)
 d = vDSP.add(multiplication: (a, b), 5) //a[i]*b[i]+5
 
 d = vDSP.subtract(a, b) //a[i]-b[i]
 print(d)
 d = vDSP.subtract(multiplication: (a, b), a)//a[i]*b[i]-a[i]
 print(d)
 
 d = vDSP.multiply(addition: (a, b), c) //(a[i]+b[i])*c[i]
 print(d)
 d = vDSP.multiply(addition: (a, b), subtraction: (a, b))//(a[i]+b[i])*(a[i]-b[i])
 print(d)
 
 
 d = vDSP.divide(a, b) //a[i]/b[i]
 print(d)
 
 print(vDSP.dot(a, b))//a[i]ç‚¹ä¹˜b[i]
 print(vDSP.absolute(a))//abs(a[i])
 
 
 d = vDSP.ramp(withInitialValue: 0, increment: 1, count: a.count) //ç”Ÿæˆç­‰å·®æ•°åˆ—
 print(d)
 
 let source:[Float] = [23.0, 2.2, 1.1, 13.2]
 let result = vDSP.floatingPointToInteger(source, integerType: UInt16.self, rounding: .towardZero) //Floatè½¬UInt16
 print(result)
 let oriResult = vDSP.integerToFloatingPoint(result, floatingPointType: Float.self) //UInt16è½¬Float
 print(oriResult)
 
 let array = [12.2, 23.3, 11.1, 34.3, 78.7, 89.8, 56.5, 23.2]
 let (id, maxResult) = vDSP.indexOfMaximum(array) //è·å–æ•°ç»„å…ƒç´ çš„æœ€å¤§å€¼åŠå…¶ç´¢å¼•
 print(id, maxResult)
</code></pre>
</blockquote>
</li>
</ul>
<h3 id="strideå’Œvdsp_lengthçš„ä½¿ç”¨">Strideå’ŒvDSP_Lengthçš„ä½¿ç”¨</h3>
<ul>
<li><code>é’ˆå¯¹å‘é‡çš„åŸºæœ¬è¿ç®—,æ–°Apiçš„è°ƒç”¨å‚æ•°æ›´å°‘ï¼Œæ–¹æ³•çš„ä½¿ç”¨æ›´åŠ ç¬¦åˆswiftè¯­è¨€çš„ä¹ æƒ¯ï¼Œä½†éœ€è¦å¯¹è¿ç®—çš„æ“ä½œå¯¹è±¡æœ‰å…¶ä»–è¦æ±‚æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ—§Apiçš„ç›¸å…³å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œè€Œå…¶ä¸­æ”¹å˜çš„ä¾¿æ˜¯æ­¥é•¿Strideå’Œè¿ç®—æ¬¡æ•°vDSP_Length</code></li>
</ul>
<blockquote>
<ul>
<li><strong>å¼•ä¾‹</strong></li>
</ul>
<pre><code class="language-swift">    let a:[Float] = [10, 20, 30, 40, 50, 60, 70, 80]
    let b:[Float] = [1, 2, 3, 4, 5, 6, 7, 8]
    var n = vDSP_Length(a.count)
    var c = [Float](repeating: .nan, count: a.count)
    
    var strideA = vDSP_Stride(1)
    var strideB = vDSP_Stride(1)
    var strideC = vDSP_Stride(1)
    
    vDSP_vadd(a, strideA, b, strideB, &amp;c, strideC, n)
    print(c) //[11.0, 22.0, 33.0, 44.0, 55.0, 66.0, 77.0, 88.0]
</code></pre>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬è¿›è¡Œäº†å‘é‡aå’Œå‘é‡bçš„å’Œè¿ç®—ï¼Œå°†ç»“æœå­˜æ”¾åœ¨å‘é‡cä¸­ã€‚æˆ‘ä»¬å°†a,b,cçš„Strideå‡è®¾ç½®ä¸º1ï¼Œåˆ™è¡¨è¾¾å¼å°†ä¼šå¯¹aã€bä¸­æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œå°†ç»“æœä¾æ¬¡å­˜æ”¾åœ¨cä¸­çš„æ¯ä¸ªå…ƒç´ ä¸­ï¼Œè¿™é‡Œè¿ç®—æ¬¡æ•°ä¸ºaçš„å…ƒç´ ä¸ªæ•°ï¼Œç±»å‹ä¸ºvDSP_Length</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>æ”¹å˜è¾“å…¥çš„Stride</strong></li>
</ul>
<pre><code class="language-swift">    //æ”¹å˜è¾“å…¥çš„Stride
    strideB = vDSP_Stride(3)
    n = vDSP_Length(3) //è¿ç®—æ¬¡æ•°
    c = [Float](repeating: .nan, count: a.count)
    vDSP_vadd(a, strideA, b, strideB, &amp;c, strideC, n)
    print(c) //[11.0, 24.0, 37.0, nan, nan, nan, nan, nan]
</code></pre>
<ul>
<li>æˆ‘ä»¬å°†bçš„Strideè®¾ä¸º3ï¼Œè¿ç®—æ¬¡æ•°nè®¾ä¸º3ï¼Œåˆ™bå‘é‡å°†å–å‡ºç¬¬0ã€3ã€6ä¸‰ä¸ªä½ç½®çš„å…ƒç´ å’Œaçš„ç¬¬0ã€1ã€2ä¸‰ä¸ªä½ç½®çš„å…ƒç´ è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç»“æœä¿å­˜åœ¨cçš„å‰ä¸‰ä¸ªå…ƒç´ ä¸­</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>æ”¹å˜è¾“å‡ºçš„Stride</strong></li>
</ul>
<pre><code class="language-swift">    //æ”¹å˜è¾“å‡ºçš„Stride
    strideA = vDSP_Stride(2)
    strideB = vDSP_Stride(1)
    strideC = vDSP_Stride(3)
    n = vDSP_Length(3)
    c = [Float](repeating: .nan, count: a.count)
    vDSP_vadd(a, strideA, b, strideB, &amp;c, strideC, n)
    print(c) //[11.0, nan, nan, 32.0, nan, nan, 53.0, nan]
</code></pre>
<ul>
<li>aã€bã€cçš„Strideåˆ†åˆ«ä¸º2ã€1ã€3ï¼Œè¿ç®—æ¬¡æ•°vDSP_Lengthä¸º3ã€‚åˆ™å°†å–å‡ºaçš„ç¬¬0ã€2ã€4ä¸ªä½ç½®å¤„çš„å…ƒç´ ï¼Œä¸bçš„0ã€1ã€2ä½ç½®å¤„çš„å…ƒç´ ç›¸åŠ ï¼Œç»“æœå­˜æ”¾åœ¨cçš„ç¬¬0ã€3ã€6å¤„çš„ä½ç½®ä¸­</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>ä½¿ç”¨è´ŸStride</strong></li>
</ul>
<pre><code class="language-swift">    //ä½¿ç”¨è´ŸStride
    strideA = vDSP_Stride(-1)
    strideB = vDSP_Stride(1)
    strideC = vDSP_Stride(1)
    n = vDSP_Length(a.count)
    a.withUnsafeBufferPointer { (buffer) in
        vDSP_vadd(buffer.baseAddress! + buffer.count - 1, strideA, b, strideB, &amp;c, strideC, n)
    }
    print(c) //[81.0, 72.0, 63.0, 54.0, 45.0, 36.0, 27.0, 18.0]
</code></pre>
<ul>
<li>å‘é‡açš„Strideä¸º-1ï¼Œè¿™æ—¶æ¯æ¬¡è¿ç®—éƒ½å°†ä¾æ¬¡å–å‡ºå½“å‰æŒ‡é’ˆæ‰€æŒ‡å…ƒç´ çš„å‰ä¸€ä¸ªä½ç½®è¿›è¡Œè¿ç®—ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æŒ‡å‘å‘é‡aæŒ‡é’ˆçš„åˆå§‹ä½ç½®ç§»åŠ¨åˆ°aä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æ¯æ¬¡è¿ç®—ä¸­ï¼Œaå°†å€’åºå–å‡ºä¸€ä¸ªæ•°ï¼Œå’Œbä¸­é¡ºåºå–å‡ºçš„ä¸€ä¸ªæ•°è¿›è¡ŒåŠ æ³•è¿ç®—</li>
</ul>
</blockquote>
<h3 id="dspcomplexä¸dspsplitcomplex">DSPComplexä¸DSPSplitComplex</h3>
<ul>
<li>
<p>åœ¨å®é™…æ•°å­¦è¿ç®—ä¸­ï¼Œæˆ‘ä»¬çš„æ“ä½œå¯¹è±¡å¾€å¾€ä¼šæ¶‰åŠåˆ°å¤æ•°åŸŸï¼Œè€Œåœ¨vDSPåº“ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å››ä¸ªç»“æ„ä½“å¯¹å¤æ•°è¿›è¡Œå­˜å‚¨ï¼šDSPComplexã€DSPDoubleComplexã€DSPSplitComplexå’ŒDSPDoubleSplitComplexã€‚å…¶ä¸­ï¼ŒDSPDoubleComplexã€DSPDoubleSplitComplexä¸DSPComplexã€DSPSplitComplexçš„åŒºåˆ«ä»…åœ¨äºè¿ç®—ç²¾åº¦çš„åŒºåˆ«ã€‚å‰è€…ä¸ºDoubleåŒç²¾åº¦ï¼Œåè€…ä¸ºFloatå•ç²¾åº¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å°±ä»¥DSPComplexã€DSPSplitComplexä¸ºä¾‹è¿›è¡Œä»‹ç»</p>
</li>
<li>
<p>DSPComplexç»“æ„</p>
<pre><code class="language-swift">public struct DSPComplex {

    public var real: Float

    public var imag: Float

    public init()

    public init(real: Float, imag: Float)
}
</code></pre>
<ul>
<li>DSPComplexä»¥æœ‰åºå¯¹çš„å½¢å¼å­˜æ”¾äº†ä¸¤ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°ï¼Œå› è€Œå½“åšç›¸å…³è¿ç®—æ—¶ï¼Œå…¶æ­¥é•¿Strideåº”ä¸º2çš„å€æ•°</li>
</ul>
</li>
<li>
<p>DSPSplitComplexç»“æ„</p>
<pre><code class="language-swift">public struct DSPSplitComplex {

    public var realp: UnsafeMutablePointer&lt;Float&gt;

    public var imagp: UnsafeMutablePointer&lt;Float&gt;

    public init(realp: UnsafeMutablePointer&lt;Float&gt;, imagp: UnsafeMutablePointer&lt;Float&gt;)
}
</code></pre>
<ul>
<li>DSPSplitComplexä¸­å­˜æ”¾äº†ä¸¤ä¸ªUnsafeMutablePointer<Float>ç±»å‹çš„æ•°ç»„ï¼Œä¸€ä¸ªç”¨æ¥å­˜æ”¾å®æ•°éƒ¨åˆ†ï¼Œå¦ä¸€ä¸ªå­˜æ”¾è™šæ•°éƒ¨åˆ†ã€‚åœ¨åšç›¸å…³è¿ç®—æ—¶ï¼Œå…¶æ­¥é•¿Strideæ˜¯è¿ç»­çš„</li>
</ul>
</li>
<li>
<p>DSPComplexä¸DSPSplitComplexè½¬åŒ–</p>
<pre><code class="language-swift">    var real:[Float] = [10, 20 ,30, 40, 50, 60, 70, 80]
    var imag:[Float] = [1, 2, 3, 4, 5, 6, 7, 8]
    let n = real.count
    let strideSplitComplex = vDSP_Stride(1)
    let strideComplex = vDSP_Stride(2)
    var complex = [DSPComplex](repeating: DSPComplex(), count: n)

    //åˆå§‹åŒ–DSPSplitComplex
    var splitComplex = DSPSplitComplex(realp: &amp;real, imagp: &amp;imag)
    //DSPSplitComplexè½¬DSPComplex
		vDSP_ztoc(&amp;splitComplex, strideSplitComplex, &amp;complex, strideComplex, vDSP_Length(n))
		//DSPComplexè½¬DSPSplitComplex
		vDSP_ctoz(&amp;complex, strideComplex, &amp;splitComplex, strideSplitComplex, vDSP_Length(n))
</code></pre>
<ul>
<li>è¿™é‡ŒvDSP_ztocå’ŒvDSP_ctozæ–¹æ³•åˆ†åˆ«ä¸ºDSPSplitComplexè½¬DSPComplexå’ŒDSPComplexè½¬DSPSplitComplexã€‚å…¶ä¸­è¦æ³¨æ„DSPComplexçš„æ­¥é•¿ä¸º2</li>
<li>è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ–°APIè¿›è¡Œç®€åŒ–ï¼š</li>
</ul>
<pre><code class="language-swift">    var real:[Float] = [10, 20 ,30, 40, 50, 60, 70, 80]
    var imag:[Float] = [1, 2, 3, 4, 5, 6, 7, 8]
  let n = real.count
    var complex = [DSPComplex](repeating: DSPComplex(), count: n)

		//åˆå§‹åŒ–DSPSplitComplex
    var splitComplex = DSPSplitComplex(realp: &amp;real, imagp: &amp;imag)
 		//DSPSplitComplexè½¬DSPComplex
    vDSP.convert(splitComplexVector: splitComplex, toInterleavedComplexVector: &amp;complex)
		//DSPComplexè½¬DSPSplitComplex
    vDSP.convert(interleavedComplexVector: complex, toSplitComplexVector: &amp;splitComplex)
</code></pre>
</li>
</ul>
<h3 id="fftç›¸å…³">FFTç›¸å…³</h3>
<ul>
<li>
<p>vDSPåº“ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥åšæ•°å­—ä¿¡å·å¤„ç†çš„åº“ï¼Œæ¯”å¦‚å‚…é‡Œå¶å˜æ¢ã€å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ç­‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹æˆ‘åœ¨é¡¹ç›®ä¸­ç”¨åˆ°çš„çª—å‡½æ•°å’ŒFFTçš„ä½¿ç”¨</p>
</li>
<li>
<p>çª—å‡½æ•°çš„ä½¿ç”¨ï¼ˆæ±‰æ˜çª—ä¸ºä¾‹ï¼‰</p>
</li>
</ul>
<blockquote>
<pre><code class="language-swift"> //æ±‰æ˜çª—å‡½æ•°
 let windowLength:Double = 2048.0
 var hammingWindow = [Float](repeating: .nan, count: Int(windowLength))
 vDSP_hamm_window(&amp;hammingWindow, vDSP_Length(windowLength), 0)
</code></pre>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º2048çš„åŒè¾¹æ±‰æ˜çª—</li>
</ul>
<pre><code class="language-swift">    //æ±‰æ˜çª—å‡½æ•°
    let windowLength:Double = 2048.0
    //æ–°API
    let hammingWindow = vDSP.window(ofType: Float.self, usingSequence: .hamming, count: Int(windowLength), isHalfWindow: false)
</code></pre>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ–°apiåˆ›å»ºäº†æ±‰æ˜çª—ï¼Œç»“æœå’Œæ—§APIä¸€è‡´ã€‚å…¶ä¸­ofTypeå‚æ•°ç¡®å®šæ±‰æ˜çª—æ“ä½œçš„ç²¾åº¦ï¼Œå³è¿”å›çš„æ•°ç»„çš„ç±»å‹ï¼›usingSequenceä¸ºç”Ÿæˆçš„çª—å‡½æ•°åºåˆ—ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ±‰æ˜çª—ï¼›countä»£è¡¨ç”Ÿæˆçš„åºåˆ—é•¿åº¦ï¼›isHalfWindowå€¼ä¸ºfalseï¼Œä»£è¡¨ç”Ÿæˆå…¨éƒ¨é•¿åº¦çš„åºåˆ—</li>
</ul>
</blockquote>
<ul>
<li>FFTï¼šå¿«é€Ÿå‚…é‡Œå¶å˜æ¢</li>
</ul>
<blockquote>
<pre><code class="language-swift">		//FFTå˜æ¢ç›¸å…³å‚æ•°è®¾ç½®
 let log2Size = Int(log2(Float(fftLength)))
 let fftSetup = vDSP_create_fftsetup(vDSP_Length(log2Size), FFTRadix(kFFTRadix2))
 //å˜æ¢çš„è¾“å…¥
 var complexBuffer = DSPSplitComplex(realp: &amp;realPart, imagp: &amp;imaginaryPart)
 //FFTå˜æ¢
		//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯fftç›¸å…³å‚æ•°ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªinoutç±»å‹æ•°ç»„ï¼Œæˆ‘ä»¬å°†å˜æ¢çš„è¾“å…¥æ•°ç»„ä¼ å…¥ï¼Œå˜æ¢ç»“æŸåï¼Œè¿”å›ç»“æœä¹Ÿæ˜¯è¯¥å‚æ•°ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºFFTå˜æ¢çš„é•¿åº¦ï¼Œè¦å–log2;ç¬¬ä¸‰ä¸ªå‚æ•°ç¡®å®šfftå˜æ¢çš„æ–¹é¢ï¼Œè¿™é‡Œé€‰å–FFT_FORWARDå‰å‘ä¼ æ’­
 vDSP_fft_zip(fftSetup!, &amp;complexBuffer, 1, vDSP_Length(log2Size), FFTDirection(FFT_FORWARD))
		//å°†fftå˜æ¢ç»“æœå–æ¨¡ï¼Œå­˜æ”¾åœ¨fftResultNoPhaseä¸­ï¼ˆå¦‚æœéœ€è¦è·å–å˜æ¢çš„å¹…å€¼ï¼‰
		vDSP_zvabs(&amp;complexBuffer, 1, &amp;fftResultNoPhase, 1, vDSP_Length(fftLength))
</code></pre>
<ul>
<li>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ–°APIç®€åŒ–ï¼š</li>
</ul>
<pre><code class="language-swift">    let log2Size = Int(log2(Float(fftLength)))
		//FFTå˜æ¢ç›¸å…³å‚æ•°è®¾ç½®
    let fwdFFT = vDSP.FFT(log2n: vDSP_Length(log2Size), radix: .radix2, ofType: DSPSplitComplex.self)!
		//FFTå˜æ¢ï¼Œè¾“å…¥è¾“å‡ºä¸ºDSPSplitComplexç±»å‹
    fwdFFT.transform(input: input, output: &amp;output, direction: .forward)
		//å˜æ¢ç»“æœå–å¹…å€¼ï¼Œå­˜æ”¾åœ¨fftResultNoPhaseä¸­
    vDSP.absolute(output, result: &amp;fftResultNoPhase)
</code></pre>
</blockquote>
<h3 id="å°ç»“">å°ç»“</h3>
<ul>
<li>vDSPåŒ…å«ç”¨äºå¤§å‹é˜µåˆ—çš„é€šç”¨ç®—æ³•çš„é«˜åº¦ä¼˜åŒ–çš„åŠŸèƒ½çš„é›†åˆï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå¤æ‚çš„æ•°ç»„è¿ç®—ã€‚åœ¨ä¸éœ€è¦å¯¹æ“ä½œæ•°ç»„çš„æ­¥é•¿Strideå’Œè¿ç®—æ¬¡æ•°nè¿›è¡Œå®šåˆ¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–°APIç®€åŒ–è°ƒç”¨</li>
<li>vDSPæœ‰å¼ºå¤§çš„ä¿¡å·å¤„ç†åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Developer Documentationä¸­æŸ¥é˜…ã€‚è¿™é‡Œæˆ‘ä»¬ç®€å•ä»‹ç»äº†çª—å‡½æ•°å’ŒFFTå˜æ¢çš„è®¾ç½®ï¼Œæ›´å¤šåŠŸèƒ½è¯·åˆ°å®˜æ–¹æ–‡æ¡£æŸ¥è¯¢ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Swiftçš„å‡ ç§ç•Œé¢ä¼ å€¼æ–¹å¼]]></title>
        <id>https://luolijie97.github.io/post/swift-jiemianchuanzhi</id>
        <link href="https://luolijie97.github.io/post/swift-jiemianchuanzhi">
        </link>
        <updated>2020-01-19T04:57:12.000Z</updated>
        <content type="html"><![CDATA[<p>swiftå¸¸ç”¨ç•Œé¢ä¼ å€¼æ–¹å¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>å•ä¾‹</th>
<th>é€šçŸ¥</th>
<th>ä»£ç†</th>
<th>é—­åŒ…</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td>å¸¸ç”¨</td>
<td>å¸¸ç”¨</td>
<td>å¸¸ç”¨</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢å°†ä½¿ç”¨<code>ViewController.swift</code>å’Œ<code>SecondViewController.swift</code>åŠ ä»¥è¯´æ˜</p>
<h3 id="1å±æ€§ä¼ å€¼">1.å±æ€§ä¼ å€¼</h3>
<blockquote>
<pre><code class="language-swift">//å±æ€§ä¼ å€¼ï¼šä»ViewControllerè·³è½¬ä¼ å€¼ç»™SecondViewController

//SecondViewController.swift
class SecondViewController: UIViewController {
var textField: UITextField!
//å±æ€§ä¼ å€¼
var tfStr: String!
}
override func viewDidLoad() {
super.viewDidLoad()
self.view.backgroundColor = .white
setupUI() //ç›¸å…³å¸ƒå±€
//å±æ€§ä¼ å€¼
textField.text = tfStr
}

//ViewController.swift
class ViewController: UIViewController {
fileprivate var textField: UITextField!
//æŒ‰é’®ç‚¹å‡»æ–¹æ³•
@objc fileprivate func btnAction() {
 let svc = SecondviewController()
 //ä¼ å€¼
 svc.tfStr = textField.text
 //è·³è½¬
 navigationController?.pushViewController(svc, animated: true)
}
}
</code></pre>
</blockquote>
<h3 id="2å•ä¾‹ä¼ å€¼">2.å•ä¾‹ä¼ å€¼</h3>
<blockquote>
<pre><code class="language-swift">//å•ä¾‹ä¼ å€¼ï¼šä»ViewControllerè·³è½¬ä¼ å€¼ç»™SecondViewController

//Singleton.swift
class Singleton {
//å•ä¾‹å±æ€§ï¼Œç”¨æ¥ä¼ å€¼
	var text: String!
static let singleton = Singleton()
//å•ä¾‹çš„å®ä¾‹æ–¹æ³•
func share() -&gt; Singleton {
 return .singleton
}
}

//ViewController.swift
class ViewController: UIViewController {
fileprivate var textField: UITextField!
//æŒ‰é’®ç‚¹å‡»æ–¹æ³•
@objc fileprivate func btnAction() {
 //ä¼ å€¼
 let singleton = Singleton.singleton.share()
 singleton.text = textField.text
 //è·³è½¬
 navigationController?.pushViewController(svc, animated: true)
}
}

//SecondViewController.swift
class SecondViewController: UIViewController {
var textField: UITextField!
var tfStr: String!
override func viewDidLoad() {
 super.viewDidLoad()
 self.view.backgroundColor = .white
 setupUI()
 //å•ä¾‹ä¼ å€¼
 tfStr = Singleton.singleton.share().text
 print(tfStr!)
 textField.text = tfStr
}
}

</code></pre>
</blockquote>
<h3 id="3é€šçŸ¥ä¼ å€¼">3.é€šçŸ¥ä¼ å€¼</h3>
<blockquote>
<pre><code class="language-swift">//é€šçŸ¥ä¼ å€¼ï¼šä»SecondViewControllerè·³è½¬ä¼ å€¼ç»™ViewController

//SecondViewController.swift
class SecondViewController: UIViewController {
var textField: UITextField!
//æŒ‰é’®ç‚¹å‡»æ–¹æ³•
@objc func btnAction() {
//é€šçŸ¥ä¼ å€¼ï¼šå‘é€é€šçŸ¥
NotificationCenter.default.post(name: NSNotification.Name(rawValue: &quot;notifyName&quot;), object: nil, userInfo: [&quot;text&quot;: self.textField.text ?? &quot;&quot;])
		//è·³è½¬
navigationController?.popViewController(animated: true)
}
}

//ViewController.swift
class ViewController: UIViewController {
fileprivate var textField: UITextField!
override func viewDidLoad() {
 super.viewDidLoad()
 self.view.backgroundColor = .white
 setupUI()
 //æ³¨å†Œé€šçŸ¥
 NotificationCenter.default.addObserver(forName: NSNotification.Name(rawValue: &quot;notifyName&quot;), object: nil, queue: .main) { (notification) in                                                                                                                       self.textField.text = &quot;\(notification.userInfo?[&quot;text&quot;] ?? &quot;&quot;)&quot;                                                                                                                         		}
}
//æ³¨é”€é€šçŸ¥
deinit {
 NotificationCenter.default.removeObserver(self)
}
}


</code></pre>
</blockquote>
<h3 id="4ä»£ç†ä¼ å€¼">4.ä»£ç†ä¼ å€¼</h3>
<blockquote>
<pre><code class="language-swift">//ä»£ç†ä¼ å€¼ï¼šä»SecondViewControllerè·³è½¬ä¼ å€¼ç»™ViewController

//SecondViewController.swift
//1.å£°æ˜åè®®ä¸æ–¹æ³•
@objc protocol SecondViewControllerDelegate: class {
@objc optional func viewController(viewController: SecondViewController, popWith)
}

class SecondViewController: UIViewController {
//2.å£°æ˜åè®®å±æ€§
weak var delegate: SecondVieControllerDelegate!
	var textField: UITextField!

@objc func btnAction() {
 //3.åè®®è°ƒç”¨
 if let delegate = self.delegate {
   delegate.viewController?(viewController: self, popWithValue: self.textField.text ?? &quot;&quot;)
 }
}
}

//ViewController.swift
//4.éµå®ˆåè®®
class ViewController: UIViewController, SecondViewControllerDelegate {
fileprivate var textField: UITextField!

//5.è®¾ç½®ä»£ç†
let svc = SecondViewController()
svc.delegate = self

//6.å®ç°åè®®æ–¹æ³•
//MARK: - SecondViewControllerDelegate
func viewController(viewController: SecondViewController, popWithValue: String) {
     textField.text = popWithValue
 }
}
</code></pre>
</blockquote>
<pre><code>### 5.é—­åŒ…ä¼ å€¼
</code></pre>
<blockquote>
<pre><code class="language-swift">//é—­åŒ…ä¼ å€¼ï¼šä»SecondViewControllerè·³è½¬ä¼ å€¼ç»™ViewController

//SecondViewController.swift
class SecondViewController: UIViewController {
var textField: UITextField!

//1.å£°æ˜é—­åŒ…ç±»å‹
typealias ClosureName = (String) -&gt; ()
//2.å£°æ˜é—­åŒ…å±æ€§
var closure: ClosureName!
//3.è®¾ç½®é—­åŒ…ä¼ å€¼è°ƒç”¨æ–¹æ³•
func callBack(closure: @escaping ClosureName) {
 self.closure = closure
}

@objc func btnAction() {
 //4.é—­åŒ…å›è°ƒ
 guard (self.closure != nil) else {
   return
 }
 closure(textField.text!)
 
 navigationController?.popViewController(animated: true)
}
}

//ViewController.swift
class ViewController: UIViewController {
fileprivate var textField: UITextField!

@objc fileprivate func btnAction() {
 let svc = SecondViewController()
 //5.è°ƒç”¨é—­åŒ…æ–¹æ³•
 svc.callBack { (value) in
     self.textField.text = value
 }
}
}
</code></pre>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Swift project in 30 days å­¦ä¹ ç¬”è®°]]></title>
        <id>https://luolijie97.github.io/post/Swift project in 30 days å­¦ä¹ ç¬”è®°</id>
        <link href="https://luolijie97.github.io/post/Swift project in 30 days å­¦ä¹ ç¬”è®°">
        </link>
        <updated>2020-01-16T13:30:33.000Z</updated>
        <content type="html"><![CDATA[<h2 id="day1-customfont">day1: CustomFont</h2>
<ul>
<li>
<p><strong><em>SnapKit</em></strong> ç¬¬ä¸‰æ–¹autolayoutè‡ªåŠ¨å¸ƒå±€åº“</p>
<pre><code class="language-swift">let changeBtn = UIButton(type: .custom)
changeBtn.snp.makeConstraints { (make) in
//            make.top.equalTo(500)
    make.top.equalTo(label.snp.bottom).offset(300)
    make.centerX.equalTo(self.view)
    make.width.equalTo(200)
  }
</code></pre>
</li>
<li>
<p>UIFont.familyNames</p>
</li>
<li>
<p>UIfont.fontNames</p>
<pre><code class="language-swift">let familyNames = UIFont.familyNames
for familyName in familyNames {
  print(&quot;+++++ \(familyName)&quot;)
  let fontNames = UIFont.fontNames(forFamilyName: familyName)
  for fontName in fontNames {
    print(&quot;---- \(fontName)&quot;)
  }
}
</code></pre>
</li>
</ul>
<h2 id="day2-watchs-demo">day2: Watch's Demo</h2>
<ul>
<li>
<p>SnapKit</p>
<pre><code class="language-swift">let resetButton = UIButton()
resetButton.snp.makeConstraints { (make) in
   make.top.equalTo(10)
   make.right.equalTo(-10)
   make.width.equalTo(100)
   make.height.equalTo(50)
}
</code></pre>
</li>
<li>
<p>Timerä½¿ç”¨</p>
</li>
<li>
<pre><code class="language-swift">var timer: Timer!
  @objc func startHander() {
      if self.timer != nil {
          self.stopHander()
      }
      self.timer = Timer.scheduledTimer(withTimeInterval: 0.1, repeats: true, block: { (Timer) in
          self.labelNumber += 0.1
          self.result.text = String(format: &quot;%.1f&quot;, self.labelNumber)
      })
      self.timer.fire()
      
  }

  @objc func stopHander() {
      guard let timerForDistory = self.timer else { return }
      timerForDistory.invalidate()
  }
  
  @objc func resetHander() {
      self.labelNumber = 0
      self.result.text = &quot;0&quot;
  }
</code></pre>
</li>
<li></li>
</ul>
<h2 id="day3-find-my-position">day3: Find My Position</h2>
<ul>
<li>
<p>æ¯›ç»ç’ƒæ•ˆæœ</p>
<ul>
<li>UIBlurEffect</li>
<li>UIVibrancyEffectï¼šæ”¾å¤§å’Œè°ƒæ•´ UIVisualEffectView è§†å›¾ä¸‹é¢çš„å†…å®¹çš„é¢œè‰²
<ul>
<li><code>//åˆ›å»ºå¹¶æ·»åŠ vibrancyè§†å›¾ let vibrancyEffect = UIVibrancyEffect(blurEffect: blurEffect)</code></li>
</ul>
</li>
<li>UIVisualEffectViewï¼šæ¨¡ç³Šè§†å›¾
<ul>
<li>//åˆ›å»ºä¸€ä¸ªæ‰¿è½½æ¨¡ç³Šæ•ˆæœçš„è§†å›¾<br>
let blurView = UIVisualEffectView(effect: blurEffect)</li>
</ul>
</li>
</ul>
<pre><code class="language-swift">        let blurEffect = UIBlurEffect(style: .light)
        let blurView = UIVisualEffectView(effect: blurEffect)
        blurView.frame = self.view.bounds
        self.view.addSubview(blurView)
</code></pre>
</li>
<li>
<p>è·å–å®šä½ï¼šCLLocationManger,CLLocationManagerDelegate</p>
<ul>
<li>
<pre><code class="language-swift">let locationManger = CLLocationManager()
let geocoder = CLGeocoder()

locationManger.delegate = self

let findMyLocationBtn = UIButton(type: .custom)
findMyLocationBtn.addTarget(self, action: #selector(findMyLocation), for: .touchUpInside)
self.view.addSubview(findMyLocationBtn)

//start find location
@objc func findMyLocation() {
  locationManger.requestAlwaysAuthorization()
  locationManger.startUpdatingLocation()
}
//CLLocationManagerDelegate
//Tells the delegate that new location data is available.
func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
  let locations: NSArray = locations as NSArray
  let currentLocation = locations.lastObject as! CLLocation
  let locationStr = &quot;lat:\(currentLocation.coordinate.latitude) lng:\(currentLocation.coordinate.longitude)&quot;

  locationLabel.text = locationStr
  reverseGeocode(location: currentLocation)
  locationManger.stopUpdatingLocation()
}
//å°†ç»çº¬åº¦è½¬æ¢ä¸ºåŸå¸‚å
func reverseGeocode(location: CLLocation) {
  geocoder.reverseGeocodeLocation(location) { (palceMark, error) in
     if (error == nil) {
         let tempArray = palceMark! as NSArray
         let mark = tempArray.firstObject as! CLPlacemark
         //now begins the reverse geocode
         let country = mark.country!
         let city = mark.locality!
         let street = mark.thoroughfare!

         let finalAddress = &quot;\(street),\(city),\(country)&quot;
         self.locationStrLabel.text = finalAddress

     }
  }
}
</code></pre>
</li>
<li></li>
</ul>
</li>
<li>
<p>ç¼©ç•¥å›¾: image literal, color literal</p>
</li>
</ul>
<h2 id="day4-limit-input-text-field">day4: Limit input Text Field</h2>
<ul>
<li>
<p>UINavigationControllerå’ŒUINavigationItemçš„ä½¿ç”¨</p>
<pre><code class="language-swift">let leftItem = UIBarButtonItem(title: &quot;close&quot;, style: .plain, target: self, action: nil)
self.navigationItem.leftBarButtonItem = leftItem
let rightItem = UIBarButtonItem(title: &quot;Tweet&quot;, style: .plain, target: self, action: nil)
rightItem.tintColor = .green
self.navigationItem.rightBarButtonItem = rightItem
self.window?.rootViewController = UINavigationController(rootViewController: ViewController())
</code></pre>
<ul>
<li><strong><code>ios13é»˜è®¤æ— UINavigationController</code></strong></li>
</ul>
</li>
<li>
<p>UITextViewDelegateä½¿ç”¨</p>
<ul>
<li>é€šè¿‡UITextViewçš„textViewDidChangeå§”æ‰˜äº‹ä»¶æ•æ‰å½“å‰è¾“å…¥å†…å®¹</li>
<li>extViewDidBeginEditing å¼€å§‹</li>
<li>textViewDidEndEditing ç»“æŸ</li>
</ul>
</li>
<li>
<p><strong><code>é€šè¿‡ç›‘å¬UIResponder.keyboardWillChangeFrameNotificationäº‹ä»¶æ¥ç›‘è§†Keyboardçš„å¼¹å‡ºå’Œæ”¶èµ·</code></strong></p>
<ul>
<li>
<p><strong>Notificationä¸­çš„userinfoæœ‰é”®ç›˜ç›¸å…³ä¿¡æ¯</strong></p>
</li>
<li>
<pre><code class="language-swift">//userinfoä¸­åŒ…å«keyboardç›¸å…³ä¿¡æ¯
//è·å¾—é”®ç›˜åŠ¨ç”»æ—¶é•¿: note.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] 
let duration = note.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] as! TimeInterval
//è·å¾—é”®ç›˜çš„endFrame: note.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] 
let endFrame = (note.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] as! NSValue).cgRectValue
</code></pre>
</li>
</ul>
</li>
<li>
<p>iosåŠ¨ç”»å®ç°ä¹‹UIView</p>
<ul>
<li>UIView.animate(withDuration:) {}</li>
</ul>
</li>
</ul>
<h2 id="day5-pull-to-refresh">day5: Pull To Refresh</h2>
<ul>
<li>
<p><strong>UIRefreshControl</strong> ä¸‹æ‹‰åˆ·æ–°æ§ä»¶ä½¿ç”¨</p>
<pre><code class="language-swift">let refresh = UIRefreshControll()
refresh.attributedTitle = .init(string:&quot;Pulling&quot;)
refresh.addTarget(self, action: #selector(pullTheRefresh), for: .valueChanged)

@objc func pullTheRefresh() {
  //...
  refresh.endRefreshing()
  //...
}
</code></pre>
</li>
<li>
<p>ä¸‹æ‹‰è§¦å‘äº‹ä»¶ï¼š <code>UIControl.Event.valueChanged</code></p>
</li>
<li>
<p>UITableViewç»„ä»¶çš„ä½¿ç”¨</p>
<ul>
<li><strong><code>delegate &amp; datasource</code></strong></li>
<li>separateor åˆ†å‰²çº¿</li>
</ul>
<pre><code class="language-swift">var table: UITableView!
table = UITableView(frame: self.view.bounds)
table.frame.origin.y = 44
table.separatorStyle = .singleLine
table.separatorColor = .black
self.view.addSubview(table)

table.delegate = self
table.dataSource = self
</code></pre>
</li>
<li>
<p><code>DateFormatter</code>æ—¥æœŸè½¬æ¢</p>
<ul>
<li>.dataFormat è½¬æ¢æ ¼å¼</li>
</ul>
<pre><code class="language-swift">let dateFormatter = DateFormatter()
dateFormatter.dateFormat = &quot;yyyyå¹´MMæœˆddæ—¥/HHæ—¶mmåˆ†ssç§’&quot;
let dateStr = dateFormatter.string(from: dataSource[indexPath.row])
</code></pre>
</li>
</ul>
<h2 id="day6-video-player">day6: Video Player</h2>
<ol>
<li>AVAudioPlayer éŸ³é¢‘æ’­æ”¾å™¨å®ä½“
<ul>
<li>AVAudioSession.shareInstance() éŸ³é¢‘ç›¸å…³è®¾ç½®</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code class="language-swift">let audioPath = Bundle.main.path(forResource: &quot;live.mp3&quot;, ofType: nil)
let audioUrl = URL(fileURLWithPath: audioPath!)
//éŸ³é¢‘åˆå§‹åŒ–
do {
audioPlayer = try AVAudioPlayer(contentsOf: audioUrl)
print(&quot;audioplayer is not nil&quot;)
} catch {
audioPlayer = nil

print(&quot;error:\(error)&quot;)
}
do {
//æ¿€æ´»éŸ³é¢‘ä¼šè¯
try AVAudioSession.sharedInstance().setCategory(.playback)
try AVAudioSession.sharedInstance().setActive(true)
} catch {
print(&quot;error:\(error)&quot;)
}
</code></pre>
</blockquote>
<ol start="2">
<li>
<p>AVAudioPlayerDelegate éŸ³é¢‘æ’­æ”¾ç›¸å…³å§”æ‰˜</p>
</li>
<li>
<p>åå°æ’­æ”¾ç›¸å…³è®¾ç½®ï¼ˆplist, codeï¼‰</p>
</li>
</ol>
<blockquote>
<p><img src="https://raw.githubusercontent.com/Luolijie97/Pic_PicGo/master/img/image-20191110142700690.png" alt="" loading="lazy"><br>
<img src="https://raw.githubusercontent.com/Luolijie97/Pic_PicGo/master/img/image-20191110142743216.png" alt="" loading="lazy"></p>
</blockquote>
<ol>
<li>é”å±ç›¸å…³è®¾ç½®
<ul>
<li>MPNowPlayingInfoCenter.default().nowPlayingInfo é”å±ä¿¡æ¯</li>
<li>remoteControlReceived ä»£ç†æ–¹æ³•å®ç°</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code class="language-swift">func initForLockScreen() {

let artWorkImage:UIImage = UIImage(named: &quot;thumb.jpg&quot;)!

MPNowPlayingInfoCenter.default().nowPlayingInfo = [
 MPMediaItemPropertyTitle:&quot;çš‡åå¤§é“ä¸œ&quot;,
 MPMediaItemPropertyArtist:&quot;ç½—å¤§ä½‘&quot;,
 MPMediaItemPropertyArtwork:MPMediaItemArtwork(boundsSize: artWorkImage.size, requestHandler: { (size) -&gt; UIImage in
                                                                                               return artWorkImage
                                                                                              }),
 MPNowPlayingInfoPropertyPlaybackRate:1.0,
 MPMediaItemPropertyPlaybackDuration:audioPlayer?.duration ?? 0,
 MPNowPlayingInfoPropertyElapsedPlaybackTime:audioPlayer?.currentTime ?? 0
]

if (audioPlayer?.isPlaying != nil) {
 MPNowPlayingInfoCenter.default().playbackState = .playing
} else {
 MPNowPlayingInfoCenter.default().playbackState = .paused
}

}

override func remoteControlReceived(with event: UIEvent?) {
switch event!.subtype {
 case .remoteControlPlay:
 audioPlayer?.play()
 case .remoteControlPause:
 audioPlayer?.pause()
 case .remoteControlStop:
 audioPlayer?.stop()
 default:
 break
}
}
</code></pre>
</blockquote>
<h2 id="day7-simple-photo-browser">day7: Simple Photo Browser</h2>
<ul>
<li>
<p>UIScrollViewä½¿ç”¨</p>
<ul>
<li>
<p>ä½¿ç”¨ç¼©æ”¾ï¼šè®¾ç½®**<code>maximumZoomScale</code><strong>å’Œ</strong><code>minimumZoomScale</code><strong>,å®ç°å§”æ‰˜æ–¹æ³•</strong><code>ViewForZooming</code>**</p>
<blockquote>
<pre><code class="language-swift">var scrollView:UIScrollView!
scrollView = UIScrollView(frame: self.view.frame)
scrollView.maximumZoomScale = 6.0
scrollView.minimumZoomScale = 1.0
scrollView.backgroundColor = .black
scrollView.contentSize = imageView.bounds.size
scrollView.delegate = self
self.view.addSubview(scrollView)

//MARK: - UIScrollViewDelegate
func viewForZooming(in scrollView: UIScrollView) -&gt; UIView? {
return imageView
}
</code></pre>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="day8-color-gradient">day8: Color Gradient</h2>
<ul>
<li>
<p>CAGradientLayer æ¸å˜å±‚çš„ä½¿ç”¨</p>
<ul>
<li><strong>frame</strong>,<strong>colors</strong>...</li>
<li><strong><code>self.view.layer.addsublayer()</code></strong></li>
<li>colors å¯ç”¨**[CGColor]**æ•°ç»„è¿›è¡Œèµ‹å€¼</li>
</ul>
<blockquote>
<pre><code class="language-swift">var grandientLayer:CAGradientLayer!
var colorSets = [[CGColor]]()
var currentColorSet:Int!
func createGradientLayer() {
grandientLayer = CAGradientLayer()
grandientLayer.frame = self.view.bounds
//set gradient color
grandientLayer.colors = colorSets[currentColorSet]
//å°†grandientLayerä½œä¸ºå­layeråŠ åˆ°ä¸»layerä¸Š
self.view.layer.addSublayer(grandientLayer)
}
</code></pre>
</blockquote>
</li>
<li>
<p>Gestureæ“ä½œä¹‹<strong>PanGestureRecognizer</strong>ï¼šâ€œæ»‘åŠ¨â€æ‰‹åŠ¿ï¼Œå¯ä»¥è¯†åˆ«æ‹–æ‹½æˆ–ç§»åŠ¨åŠ¨ä½œ</p>
<ul>
<li>
<p>åˆå§‹åŒ–UIPanGestureRecognizer</p>
<pre><code class="language-swift">let panGestureRecognizer = UIPanGestureRecognizer(target: self, action: #selector(handlePanGesture(sender:)))
</code></pre>
</li>
<li>
<p>å°†æ‰‹åŠ¿æ·»åŠ åˆ°è§†å›¾ä¸Š</p>
<pre><code class="language-swift">self.view.addGestureRecogizer(panGestureRecognizer)
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="day9-swipeable-cell">day9: Swipeable Cell</h2>
<ul>
<li>
<p>UItableViewä½¿ç”¨</p>
<ul>
<li>
<p>**<code>UIContextualAction</code>**çš„é—­åŒ…ç”¨æ³•</p>
<p><strong>https://www.jianshu.com/p/847deff29f24</strong></p>
<p><strong>https://www.jianshu.com/p/14d778afeefc</strong></p>
</li>
</ul>
<pre><code class="language-swift">//MARK: - UITableViewDataSource
func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int
{
  //è¿”å›æ¯ä¸ªsectionä¸­çš„è¡Œæ•°
}
//Asks the data source for a cell to insert in a particular location of the table view.
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
  // cellçš„åˆå§‹åŒ–ä¸å¤ç”¨ï¼Œè¿”å›cell
}

//MARK: - UITableViewDelegate
//ä»å°¾éƒ¨å¼€å§‹å‘å·¦æ»‘åŠ¨cell
func tableView(_ tableView: UITableView, trailingSwipeActionsConfigurationForRowAt indexPath: IndexPath) -&gt; UISwipeActionsConfiguration? {
  //Returns the swipe actions to display on the trailing edge of the row.
  let likeAction = UIContextualAction(style: .normal, title: &quot;ğŸ‘&quot;) { (action, view, finished) in
            self.actionController.message = &quot;Thanks for your Love ğŸ˜¸&quot;
            self.showAlertController()
            finished(true)
        }
        likeAction.backgroundColor = .white
        
        let disLikeAction = UIContextualAction(style: .normal, title: &quot;ğŸ‘&quot;) { (action, view, finished) in
            self.actionController.message = &quot;Tell me Why!!!ğŸ˜¤&quot;
            self.showAlertController()
            finished(true)
        }
        disLikeAction.backgroundColor = .white
        
        let unknowAction = UIContextualAction(style: .destructive, title: &quot;ğŸ––&quot;) { (action, view, finished) in
            self.actionController.message = &quot;What do you mean? ğŸ¤”&quot;
            self.showAlertController()
            finished(true)
        }
        unknowAction.backgroundColor = .white
        //actionä»å³å‘å·¦çš„é¡ºåºæ·»åŠ 
        return .init(actions: [likeAction, disLikeAction , unknowAction])
}
</code></pre>
</li>
<li>
<p>**<code>UIAlertController</code>**çš„ä½¿ç”¨</p>
<pre><code class="language-swift">private var actionController: UIAlertController!
//init alertController
actionController = UIAlertController(title: &quot;alert&quot;, message: &quot;&quot;, preferredStyle: .alert)
//...
self.actionController.message = &quot;123&quot;
present(actionController, animated: true) {
  let dismissTimer = Timer.sheduledTimer(withTimeInterval: 2.0, repeats: false) {
    (timer) in 
    	self.actionController.dismiss(animate: true, completion: nil)
  }
  RunLoop.main.add(dismissTimer, forMode: .comoon)
}

</code></pre>
</li>
<li>
<p><strong><code>UIViewåŠ¨ç”»ä½¿ç”¨</code></strong></p>
<pre><code class="language-swift">//cellçš„æ˜¾ç¤ºåŠ¨ç”»
let cells = tableView.visibleCells
let tableHeight:CGFloat = tableView.bounds.size.height
for (index, cell) in cells.enumerated() {
  cell.frame.origin.y = tableHeight
  UIView.animate(withDuration: 1.0, delay: 0.04 * Double(index), usingSpringWithDamping: 0.8, initialSpringVelocity: 0, options: [], animations: {
    cell.frame.origin.y = 0
  }, completion: nil)
}
</code></pre>
</li>
</ul>
<h2 id="day10-stretchy-header">day10 Stretchy Header</h2>
<ul>
<li>
<p>UIScrollViewDelegateä½¿ç”¨</p>
<pre><code class="language-swift">//MARK: - UIScrollViewDelegate
func scrollViewDidScroll(_ scrollView: UIScrollView) {
  let offsetY = scrollView.contentOffset.y
  let maxOffsetY = tableView.frame.height
  let validateOffsetY = -offsetY / maxOffsetY
  let scaleFactor = 1 + validateOffsetY
  bannerImgView.transform = CGAffineTransform(scaleX: scaleFactor, y: scaleFactor)

}
</code></pre>
</li>
</ul>
<h2 id="day11-gradienttableview">day11 GradientTableView</h2>
<ul>
<li>
<p>UITableViewçš„æ¸å˜å±‚</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
  let cell = UITableViewCell(style: .default, reuseIdentifier: &quot;reuseId&quot;)
  cell.textLabel?.text = self.dataSource[indexPath.row]
  cell.textLabel?.textColor = .white
  cell.selectionStyle = .none

  //cell -&gt; bgView -&gt; gradientLayer, move bgView back to the cell
  let bgview = UIView(frame: CGRect(x: 0, y: 0, width: self.view.frame.width, height: self.cellHeight))
  let gradientLayer = CAGradientLayer()
  gradientLayer.frame = bgview.frame

  let lowerColor:CGColor = UIColor(red: 1.0, green: (CGFloat(indexPath.row * 2) * self.colorRatio)/255.0, blue: (CGFloat(indexPath.row * 2) * self.colorRatio)/255.0, alpha: 1).cgColor
  let upperColor:CGColor = UIColor(red: 1.0, green: (CGFloat(indexPath.row * 2) * self.colorRatio + self.colorRatio)/255.0, blue: (CGFloat(indexPath.row * 2) * self.colorRatio + self.colorRatio)/255.0, alpha: 1).cgColor

  gradientLayer.colors = [lowerColor, upperColor]
  bgview.layer.addSublayer(gradientLayer)
  cell.insertSubview(bgview, belowSubview: cell.contentView)

  /* equal to below
  cell.addSubview(bgview)
  cell.sendSubviewToBack(bgview)
  */

  return cell
}
</code></pre>
</li>
</ul>
<h2 id="day12-emoji-slot-machine">day12 Emoji Slot Machine</h2>
<ul>
<li>
<p><strong>UIPickerView</strong>çš„ä½¿ç”¨</p>
<ul>
<li>åˆå§‹åŒ–</li>
</ul>
<blockquote>
<pre><code class="language-swift">slotMachine = UIPickerView(frame: CGRect(x: 0, y: 0, width: self.view.frame.width, height: 220))
self.view.addSubview(slotMachine)
slotMachine.dataSource = self
slotMachine.delegate = self
slotMachine.center.x = self.view.center.x
slotMachine.center.y = self.view.center.y - 50

slotMachine.selectRow(Int(arc4random())%(emojiArray.count), inComponent: 0, animated: false)
slotMachine.selectRow(Int(arc4random())%(emojiArray.count), inComponent: 1, animated: false)
slotMachine.selectRow(Int(arc4random())%(emojiArray.count), inComponent: 2, animated: false)
</code></pre>
</blockquote>
<ul>
<li>
<p><strong>UIPickerViewDataSource</strong>ç›¸å…³</p>
<blockquote>
<pre><code class="language-swift">func numberOfComponents(in pickerView: UIPickerView) -&gt; Int {
return 3
}

func pickerView(_ pickerView: UIPickerView, numberOfRowsInComponent component: Int) -&gt; Int {
return emojiArray.count
}
</code></pre>
</blockquote>
</li>
<li>
<p><strong>UIPickerViewDelegate</strong>ç›¸å…³</p>
<blockquote>
<pre><code class="language-swift">func pickerView(_ pickerView: UIPickerView, rowHeightForComponent component: Int) -&gt; CGFloat {
return 90
}

func pickerView(_ pickerView: UIPickerView, viewForRow row: Int, forComponent component: Int, reusing view: UIView?) -&gt; UIView {
let pickerLabel = UILabel()
pickerLabel.text = emojiArray[row]
pickerLabel.textAlignment = .center
pickerLabel.font = .systemFont(ofSize: 60)
return pickerLabel
}
</code></pre>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="day13-loginanimation">day13 LoginAnimation</h2>
<ul>
<li>
<p>UINavigationControllerçš„ä½¿ç”¨</p>
<pre><code class="language-swift">//Pushes a view controller onto the receiverâ€™s stack and updates the display.
let loginVC = LoginViewController()
self.navigationController?.pushViewController(loginVC, animated: false)

//Pops the top view controller from the navigation stack and updates the display.
self.navigationController?.popViewController(animated: true)
</code></pre>
</li>
<li>
<p>UIView.animateåŠ¨ç”»æ•ˆæœ</p>
<pre><code class="language-swift">//åˆå§‹çŠ¶æ€
self.view.alpha = 0
let userNameInputField = UITextField(frame: CGRect(x: -270, y: 50, width: 270, height: 40))
let pswInputField = UITextField(frame: CGRect(x: -270, y: 100, width: 270, height: 40))
let loginButton = UIButton(frame: CGRect(x: -125, y: 160, width: 125, height: 40))
//åŠ¨ç”»æ•ˆæœ
UIView.animate(withDuration: 0.5) {
  self.view.alpha = 1
}

UIView.animate(withDuration: 0.5, delay: 0.6, usingSpringWithDamping: 0.9, initialSpringVelocity: 2, options: .allowAnimatedContent, animations: {
  userNameInputField.center.x = self.view.center.x
}, completion: nil)

UIView.animate(withDuration: 0.5, delay: 0.8, usingSpringWithDamping: 0.9, initialSpringVelocity: 2, options: .allowAnimatedContent, animations: {
  pswInputField.center.x = self.view.center.x
}, completion: nil)

UIView.animate(withDuration: 0.5, delay: 1, options: .curveEaseIn,animations: {
  loginButton.center.x = self.view.center.x
}) { (isComplete) in
    // usingSpringWithDamping: 0-1, the less the more exaggerate
    // initialSpringVelocity: the bigger the faster init speed
    UIView.animate(withDuration: 1, delay: 0.5, usingSpringWithDamping: 0.1, initialSpringVelocity: 2, options:.allowAnimatedContent, animations: {
      loginButton.frame.size.width = 180
      loginButton.center.x = self.view.center.x
    }, completion: nil)
   }
</code></pre>
</li>
</ul>
<h2 id="day14-spotlight-search">day14 Spotlight Search</h2>
<ol>
<li>
<p>CSSearchableItemAttributeSetä½¿ç”¨</p>
<pre><code class="language-swift">//Spotlight æœç´¢é…ç½®
let attributSet = CSSearchableItemAttributeSet(itemContentType: &quot;test&quot;)
attributSet.title = itemDic[&quot;name&quot;] as? String
attributSet.contentDescription = itemDic[&quot;description&quot;] as? String
let imageData = (itemDic[&quot;cover&quot;] as? UIImage)!.jpegData(compressionQuality: 0.7)
attributSet.thumbnailData = imageData

let searchItem = CSSearchableItem(uniqueIdentifier: &quot;\(indexPath.row)&quot;, domainIdentifier: &quot;nimomeng&quot;, attributeSet: attributSet)
let tempItems = [searchItem]
CSSearchableIndex.default().indexSearchableItems(tempItems) { (error) in
                                                            }

//AppDelegate.swift
public let notificationName = NSNotification.Name.init(&quot;receivedIdFromSpotlightSearch&quot;)

//ï¼Ÿï¼Ÿæµ‹è¯•ä¸è°ƒç”¨
//åº”ç”¨ç¨‹åºåœ¨æ”¶åˆ°ä¸ç”¨æˆ·æ´»åŠ¨ç›¸å…³çš„æ•°æ®æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä½¿ç”¨â€œè¶ŠåŒºåˆ‡æ¢â€ä»å…¶ä»–è®¾å¤‡è½¬ç§»æ´»åŠ¨æ—¶ã€‚
func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -&gt; Void) -&gt; Bool {

  if userActivity.activityType == CSSearchableItemActionType {
    if let identifier = userActivity.userInfo?[CSSearchableItemActivityIdentifier] as? String {
      NotificationCenter.default.post(name: notificationName, object: self, userInfo: [&quot;id&quot;: identifier])
    }
  }
  return true
}

//ViewController.swift 
 @objc func receivedNotification(sender: Notification) {
        let userInfo = sender.userInfo
        let index = Int(userInfo?[&quot;id&quot;] as! String)
        let itemDic = dataSource[index!]
        let detailVC = DetailViewController.init(with: itemDic)
        
        self.navigationController?.pushViewController(detailVC, animated: true)
    
    }
</code></pre>
</li>
</ol>
<h2 id="day15-today-widget">day15 Today Widget</h2>
<h3 id="1-today-widgetçš„å»ºç«‹">1. Today Widgetçš„å»ºç«‹</h3>
<blockquote>
<pre><code class="language-swift">//File &gt; New &gt; Target &gt; Applicaion Extension -&gt; Today Extension
//target &gt; capabilities &gt; App Group -&gt; open
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/Luolijie97/Pic_PicGo/master/img/image-20191122105321030.png" alt="" loading="lazy"></figure>
</blockquote>
<h3 id="2-userdefaultçš„ä½¿ç”¨">2. UserDefaultçš„ä½¿ç”¨</h3>
<blockquote>
<pre><code class="language-swift">//é»˜è®¤UserDefaults
let defaults = UserDefaults.standard
defaults.set(123, forKey: &quot;defaultKey&quot;)
defaults.integer(forKey: &quot;defaultKey&quot;)

//è‡ªå®šä¹‰UserDefaults
let userDefault = UserDefaults(suiteName: &quot;group.llj.watchDemo&quot;)
userDefault?.set(self.labelNumber, forKey: &quot;lefttime&quot;)
userDefault?.removeObject(forKey: &quot;lefttime&quot;)
</code></pre>
</blockquote>
]]></content>
    </entry>
</feed>